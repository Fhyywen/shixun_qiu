name: "deepnote_pipeline"
version: "1.0"
description: "DeepNote 多轮推理流水线"

steps:
  - name: "initial_retrieval"
    type: "retrieve"
    parameters:
      top_k: 7
      threshold: 0.6

  - name: "check_sufficiency"
    type: "conditional"
    parameters:
      condition:
        type: "document_count"
        min_documents: 3
      then:
        - name: "generate_final_answer"
          type: "generate"
          parameters:
            prompt_template: |
              基于以下完整信息回答问题：

              {context}

              问题: {query}

              综合以上信息，请提供最终回答:
      else:
        - name: "refinement_loop"
          type: "loop"
          parameters:
            max_iterations: 3
            break_condition:
              type: "document_count"
              min_documents: 2
            steps:
              - name: "generate_subquestion"
                type: "generate"
                parameters:
                  prompt_template: |
                    基于当前信息，生成一个澄清问题来获得更多信息：

                    当前信息: {context}
                    原始问题: {query}

                    请生成一个澄清问题:

              - name: "retrieve_more"
                type: "retrieve"
                parameters:
                  top_k: 3
                  threshold: 0.5